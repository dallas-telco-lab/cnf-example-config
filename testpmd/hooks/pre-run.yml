---
- name: Check if namespace exists
  k8s_info:
    api_version: v1
    kind: namespace
    name: "{{ dci_openshift_app_ns | default('example-cnf') }}"
  register: example_cnf_namespace

- name: Delete namespace if exists
  k8s:
    api_version: v1
    kind: namespace
    name: "{{ dci_openshift_app_ns | default('example-cnf') }}"
    state: absent
  when: example_cnf_namespace.resources|length > 0

- name: Deploy Red Hat Catalog Source
  include_tasks: config/redhat-catalog-source.yaml

- name: Enable Peformance Addon Operator and Profile
  include_tasks: config/performance.yaml
  when: enable_perf_addon|default(true)

- name: Enable SR-IOV operator and Networks
  include_tasks: config/sriov.yaml
  when: enable_sriov|default(true)

- name: Checkout Example CNF deployment role
  git:
    repo: 'https://github.com/rh-nfv-int/nfv-example-cnf-deploy.git'
    dest: "{{ dci_config_dir }}/hooks/nfv-example-cnf-deploy"
    update: yes
  register: gitresult

- debug: msg="Git hash is {{ gitresult.after }}"
